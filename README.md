# Enterprise-level Chinese knowledge Q&A system (ä¼ä¸šçº§ä¸­æ–‡çŸ¥è¯†é—®ç­”ç³»ç»Ÿ)

![Python](https://img.shields.io/badge/Python-3.10%2B-blue.svg)
![FastAPI](https://img.shields.io/badge/FastAPI-0.110.0-green.svg)
![Streamlit](https://img.shields.io/badge/Streamlit-1.36.0-red.svg)
![PyTorch](https://img.shields.io/badge/PyTorch-2.5.1%2Bcu121-orange.svg)
![Milvus](https://img.shields.io/badge/Milvus-v2.4.6-lightgrey.svg)
![Redis](https://img.shields.io/badge/Redis-latest-red)
![License](https://img.shields.io/badge/License-MIT-blue.svg)

## ğŸ“– é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®æ—¨åœ¨æ„å»ºä¸€ä¸ª**é«˜æ•ˆã€ç²¾å‡†çš„ä¼ä¸šçº§çŸ¥è¯†é—®ç­”ç³»ç»Ÿ**ï¼Œåˆ©ç”¨å…ˆè¿›çš„**æ£€ç´¢å¢å¼ºç”Ÿæˆ (Retrieval-Augmented Generation, RAG)** æŠ€æœ¯ï¼Œç»“åˆå¤§è§„æ¨¡è¯­è¨€æ¨¡å‹ (LLM) å’Œä¸“ä¸šçŸ¥è¯†åº“ï¼Œä¸ºç”¨æˆ·æä¾›æ™ºèƒ½ã€æƒå¨çš„é—®ç­”æœåŠ¡ã€‚ç³»ç»Ÿè§£å†³äº†ä¼ ç»Ÿé—®ç­”æ£€ç´¢æ•ˆç‡ä½ä¸‹ã€ä¿¡æ¯å­¤å²›ä¸¥é‡çš„é—®é¢˜ï¼Œå¤§å¹…æå‡äº†çŸ¥è¯†è·å–æ•ˆç‡å’Œè¾…åŠ©å†³ç­–èƒ½åŠ›ã€‚

### âœ¨ æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹ç‚¹

*   **æ™ºèƒ½é—®ç­”ï¼š** é’ˆå¯¹ç”¨æˆ·æå‡ºçš„äº§å“ç­‰é—®é¢˜ï¼Œæä¾›å‡†ç¡®ã€è¿è´¯ä¸”æœ‰æ®å¯æŸ¥çš„ç­”æ¡ˆã€‚
*   **æ··åˆæ£€ç´¢ç­–ç•¥ï¼š** ç»“åˆè¯­ä¹‰æ£€ç´¢ (å‘é‡ç›¸ä¼¼åº¦) å’Œå…³é”®è¯æ£€ç´¢ (BM25)ï¼Œç¡®ä¿ä»æµ·é‡çŸ¥è¯†åº“ä¸­å¬å›æœ€ç›¸å…³ã€æœ€å…¨é¢çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚
*   **é«˜æ€§èƒ½ Rerankingï¼š** é€šè¿‡ç‹¬ç«‹çš„é‡æ’æ¨¡å‹å¯¹åˆæ¬¡æ£€ç´¢ç»“æœè¿›è¡Œç²¾ç»†æ’åºï¼Œè¿›ä¸€æ­¥æå‡ä¸Šä¸‹æ–‡ä¸æŸ¥è¯¢çš„ç›¸å…³æ€§ã€‚
*   **å®æ—¶äº¤äº’ç•Œé¢ï¼š** æä¾›åŸºäº Streamlit çš„ç”¨æˆ·å‹å¥½å‹ Web ç•Œé¢ï¼Œæ”¯æŒå®æ—¶é—®ç­”ä¸ç»“æœå±•ç¤ºã€‚
*   **æ¨¡å—åŒ–ä¸å¯æ‰©å±•ï¼š** æ¸…æ™°çš„ä»£ç ç»“æ„å’Œåˆ†å±‚è®¾è®¡ï¼Œä¾¿äºåŠŸèƒ½æ‰©å±•ã€æ¨¡å‹æ›¿æ¢å’Œç»´æŠ¤ã€‚
*   **é«˜æ•ˆç¼“å­˜æœºåˆ¶ï¼š** é›†æˆ Redis ç¼“å­˜ï¼Œæ˜¾è‘—æå‡é‡å¤æŸ¥è¯¢çš„å“åº”é€Ÿåº¦ã€‚
*   **API æœåŠ¡åŒ–ï¼š** åŸºäº FastAPI æä¾›ç¨³å®šã€é«˜æ€§èƒ½çš„ RESTful API æ¥å£ï¼Œæ–¹ä¾¿å…¶ä»–åº”ç”¨é›†æˆã€‚
*   **GPU åŠ é€Ÿï¼š** åˆ©ç”¨ PyTorch å’Œ NVIDIA GPU ç¡¬ä»¶åŠ é€Ÿ LLM æ¨ç†å’Œ Embedding è®¡ç®—ã€‚

## ğŸš€ æ•ˆæœæ¦‚è§ˆ

æœ¬é¡¹ç›®é‡‡ç”¨å‰åç«¯åˆ†ç¦»çš„å¾®æœåŠ¡æ¶æ„ï¼Œæ ¸å¿ƒ RAG é€»è¾‘å°è£…åœ¨ FastAPI åç«¯ä¸­ï¼Œå¹¶é€šè¿‡ Streamlit æä¾›äº¤äº’ç•Œé¢ã€‚
![image-20250912155108981](/home/ubuntu/.config/Typora/typora-user-images/image-20250912155108981.png)

## ğŸ’» æŠ€æœ¯æ ˆ


    æ£€ç´¢å¢å¼ºç”Ÿæˆ (RAG) æ¶æ„ï¼š é‡‡ç”¨æ··åˆæ£€ç´¢ç­–ç•¥ï¼ˆDense + Sparseï¼‰ï¼Œç»“åˆè¯­ä¹‰æ£€ç´¢å’Œå…³é”®è¯æ£€ç´¢ä¼˜åŠ¿ï¼Œç¡®ä¿ä»æµ·é‡çŸ¥è¯†åº“ä¸­å¬å›æœ€ç›¸å…³çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚
    
    LLM é›†æˆ (HuggingFaceLLM)ï¼š æ·±åº¦é›†æˆ HuggingFaceLLMï¼ŒåŠ è½½å¹¶åˆ©ç”¨ Qwen2-7B-Instruct ç­‰å¤§å‹è¯­è¨€æ¨¡å‹è¿›è¡Œç­”æ¡ˆç”Ÿæˆï¼Œç¡®ä¿å›ç­”çš„å‡†ç¡®æ€§ã€è¿è´¯æ€§å’Œä¸“ä¸šæ€§ã€‚
    
    å‘é‡æ•°æ®åº“ (Milvus)ï¼š åˆ©ç”¨é«˜æ€§èƒ½å‘é‡æ•°æ®åº“ Milvus å­˜å‚¨å’Œç®¡ç†çŸ¥è¯†æ–‡æ¡£çš„åµŒå…¥å‘é‡ï¼Œå®ç°é«˜æ•ˆçš„è¯­ä¹‰ç›¸ä¼¼åº¦æ£€ç´¢ã€‚
    
    é«˜æ€§èƒ½åµŒå…¥ä¸é‡æ’ (Embedding & Reranking)ï¼š é‡‡ç”¨ BAAI/bge-large-zh ä½œä¸ºåµŒå…¥æ¨¡å‹ï¼Œæå‡ä¸­æ–‡æ–‡æœ¬çš„è¯­ä¹‰è¡¨ç¤ºèƒ½åŠ›ï¼›å¼•å…¥ BAAI/bge-reranker-base è¿›è¡Œæ–‡æ¡£é‡æ’ï¼Œä¼˜åŒ–æ£€ç´¢ç»“æœçš„ç›¸å…³æ€§ï¼Œæé«˜RAGå¬å›è´¨é‡ã€‚
    
    ç¼“å­˜æœºåˆ¶ (Redis)ï¼š é›†æˆ Redis ä½œä¸ºé«˜æ€§èƒ½ç¼“å­˜å±‚ï¼Œå­˜å‚¨å¸¸è§æŸ¥è¯¢ç»“æœï¼Œæ˜¾è‘—æå‡ç³»ç»Ÿå“åº”é€Ÿåº¦å’Œèµ„æºåˆ©ç”¨ç‡ã€‚
    
    æ¨¡å—åŒ–ä¸å¯æ‰©å±•æ¶æ„ï¼š é‡‡ç”¨æ¸…æ™°çš„å±‚æ¬¡åŒ–è®¾è®¡ï¼ˆconfig, models, services, api, utilsï¼‰ï¼Œç¡®ä¿ç³»ç»Ÿçš„é«˜å†…èšã€ä½è€¦åˆï¼Œæ˜“äºç»´æŠ¤å’ŒåŠŸèƒ½æ‰©å±•ã€‚
    
    Web æœåŠ¡ (FastAPI)ï¼š åˆ©ç”¨ FastAPI æ¡†æ¶æ„å»ºé«˜æ€§èƒ½ã€å¼‚æ­¥çš„ RESTful API æœåŠ¡ï¼Œæä¾›ç¨³å®šã€å¯æ‰©å±•çš„åç«¯æ”¯æ’‘ã€‚
    
    äº¤äº’å¼å‰ç«¯ (Streamlit)ï¼š ä½¿ç”¨ Streamlit å¿«é€Ÿå¼€å‘ç›´è§‚ã€ç”¨æˆ·å‹å¥½çš„äº¤äº’å¼é—®ç­”ç•Œé¢ï¼Œæ–¹ä¾¿ç”¨æˆ·è¿›è¡Œå®æ—¶æé—®å’Œç»“æœå±•ç¤ºã€‚

## âš™ï¸ å¿«é€Ÿå¼€å§‹ (ä½¿ç”¨ Docker Compose)

æ­¥éª¤1ï¼šå…‹éš†æˆ‘çš„ä»“åº“ï¼Œå®‰è£…requirement.txt

ä¸‹è½½ä»£ç è‡³æœ¬åœ°ï¼›

```bash
pip install -r requirements.txt
```

æ­¥éª¤ 2: ä¸‹è½½å¹¶å­˜æ”¾å¤§æ¨¡å‹æ–‡ä»¶

ç”±äºæ¨¡å‹æ–‡ä»¶è¾ƒå¤§ï¼Œæ²¡æœ‰ä¸Šä¼ åˆ°ä»“åº“ä¸­ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬å°†å…¶ä¸‹è½½åˆ°æœ¬åœ°ç›®å½•çš„modelsä¸­ã€‚


```python
#ä¸‹è½½ä»¥ä¸‹æ¨¡å‹åˆ°å¯¹åº”çš„ç›®å½•ï¼š
    BAAI/bge-large-zh (åµŒå…¥æ¨¡å‹): ä¸‹è½½åˆ° ./models/BAAI/bge-large-zh/
       # å¯é€šè¿‡ Hugging Face Hub ä¸‹è½½ï¼šhuggingface-cli download BAAI/bge-large-zh --local-dir /home/ubuntu/models/BAAI/bge-large-zh
    BAAI/bge-reranker-base (é‡æ’æ¨¡å‹): ä¸‹è½½åˆ° ./models/BAAI/bge-reranker-base/
     #   å¯é€šè¿‡ Hugging Face Hub ä¸‹è½½ï¼šhuggingface-cli download BAAI/bge-reranker-base --local-dir /home/ubuntu/models/BAAI/bge-reranker-base
    Qwen2-7B-Instruct (LLM): ä¸‹è½½åˆ° ./models/qwen/Qwen2-7B-Instruct/
      #  å¯é€šè¿‡ Hugging Face Hub ä¸‹è½½ï¼šhuggingface-cli download Qwen/Qwen2-7B-Instruct --local-dir /home/ubuntu/models/qwen/Qwen2-7B-Instruct
```


æ­¥éª¤ 3: å‡†å¤‡çŸ¥è¯†åº“æ•°æ®

ç¡®ä¿ä½ çš„çŸ¥è¯†åº“æ–‡ä»¶ï¼ˆä¾‹å¦‚ TCM.jsonï¼‰æ”¾ç½®åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ data/ ç›®å½•ä¸­ã€‚

æ­¥éª¤4ï¼šå¯åŠ¨milvus-standaloneå’ŒredisæœåŠ¡

```bash
cd ä½ çš„milvuså®‰è£…ç›®å½• # ç¡®ä¿ä½ åœ¨è¿™ä¸ªç›®å½•
bash standalone_embed.sh start
```

```bash
sudo systemctl start redis-server
```

æ­¥éª¤5: å¯åŠ¨streamlitæœåŠ¡

```bash
streamlit run ui/streamlit_app.py
```



## ğŸ“¦ é¡¹ç›®ç»“æ„

.
â”œâ”€â”€ api/  # FastAPI åç«¯æœåŠ¡
â”‚   â””â”€â”€ main.py              # FastAPI åº”ç”¨ä¸»å…¥å£
â”œâ”€â”€ config/                  # ç³»ç»Ÿé…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ settings.py          # å…¨å±€é…ç½® (æ¨¡å‹è·¯å¾„, Milvus, Redis, åº”ç”¨è®¾ç½®ç­‰)
â”œâ”€â”€ data/  # çŸ¥è¯†åº“æ•°æ®ç›®å½•
â”‚   â””â”€â”€ TCM.json             # æ‚¨çš„çŸ¥è¯†åº“æ–‡ä»¶
â”œâ”€â”€ models/                  # æ¨¡å‹å°è£…ä¸åŠ è½½é€»è¾‘
â”‚   â”œâ”€â”€ QWEN                 # qwenæ¨¡å‹
â”‚   â””â”€â”€ BAAI                 # embeddingæ¨¡å‹å’Œrerankæ¨¡å‹
â”œâ”€â”€ services/                # RAG æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ rag_service.py       # RAG æœåŠ¡æ ¸å¿ƒ (åè°ƒå„ç»„ä»¶)
â”‚   â”œâ”€â”€ document_processor.py# æ–‡æ¡£åŠ è½½ã€åˆ†å—ä¸èŠ‚ç‚¹åˆ›å»º
â”‚   â”œâ”€â”€ retriever.py         # æ··åˆæ£€ç´¢ä¸é‡æ’é€»è¾‘ (Milvus, BM25, Reranker)
â”‚   â””â”€â”€ answer_generator.py  # LLM ç­”æ¡ˆç”Ÿæˆ
â”œâ”€â”€ utils/                   # å·¥å…·ç±»ä¸è¾…åŠ©å‡½æ•°
â”‚   â”œâ”€â”€ cache.py             # Redis ç¼“å­˜ç®¡ç†
â”‚   â”œâ”€â”€ logger.py            # è‡ªå®šä¹‰æ—¥å¿—æ¨¡å—
â”‚   â””â”€â”€ metrics.py           # ç³»ç»Ÿè¿è¡ŒæŒ‡æ ‡æ”¶é›†
â”œâ”€â”€ Dockerfile               # æ„å»º FastAPI å’Œ Streamlit å®¹å™¨çš„ Dockerfile
â”œâ”€â”€ docker-compose.yml       # Docker Compose é…ç½®æ–‡ä»¶ (ä¸€é”®éƒ¨ç½²æ‰€æœ‰æœåŠ¡)
â”œâ”€â”€ requirements.txt         # Python ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ run_api.py               # å¯åŠ¨ FastAPI æœåŠ¡çš„è„šæœ¬ (ä¸ç”¨äºDocker Composeéƒ¨ç½²)
â”œâ”€â”€ streamlit_app.py         # Streamlit å‰ç«¯åº”ç”¨
â””â”€â”€ logs/  # æ—¥å¿—æ–‡ä»¶è¾“å‡ºç›®å½•



## ğŸ“œ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ï¼Œè¯¦è§ LICENSE æ–‡ä»¶ã€‚

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡ GitHub Issue æäº¤ï¼Œæˆ–è€…å‘é€é‚®ä»¶è‡³ 1039995947@qq.comã€‚
